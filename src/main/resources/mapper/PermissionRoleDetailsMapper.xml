<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="maint.mapper.PermissionRoleDetailsMapper">

    <select id="getPermissionListByPk" resultType="UserPermissionDto">
        SELECT "menu"."menu_code"
             , "menu"."display_order"
             , "parent_menu"."menu_code"     AS "parentMenuCode"
             , "parent_menu"."display_order" AS "parentDisplayOrder"
             , "prd"."write_perm_flg"
             , "prd"."download_perm_flg"
             , "prd"."read_perm_flg"
          FROM "permission_role_details" "prd"
    INNER JOIN "menus" "menu"
            ON "menu"."menu_code"         = "prd"."menu_code"
     LEFT JOIN "menus" "parent_menu"
            ON "parent_menu"."menu_code"  = "menu"."parent_code"
         WHERE "prd"."del_flag"           = 0
           AND "prd"."perm_role_id"       = #{value}
    </select>

    <insert id="insert">
        INSERT INTO "permission_role_details" (
               "perm_role_id"
             , "menu_code"
             , "write_perm_flg"
             , "download_perm_flg"
             , "read_perm_flg"
               <include refid="maint.mapper.CommonMapper.insertCommonItemColumns"/>
        )
        VALUES
        <foreach collection="list" item="item" separator=",">
            (
              #{item.permRoleId}
            , #{item.menuCode}
            , #{item.writePermFlg}
            , #{item.downloadPermFlg}
            , #{item.readPermFlg}
            <include refid="maint.mapper.CommonMapper.insertCommonItemValues"/>
            )
        </foreach>
    </insert>

    <update id="deleteByPermRoleId">
        UPDATE "permission_role_details"
           SET "del_flag"           = "perm_role_detail_id"
        <include refid="maint.mapper.CommonMapper.updateCommon"/>
         WHERE "del_flag"           = 0
           AND "perm_role_id" = #{permRoleId}
    </update>

    <update id="delete">
        UPDATE "permission_role_details"
           SET "del_flag"           = "perm_role_detail_id"
        <include refid="maint.mapper.CommonMapper.updateCommon"/>
         WHERE "del_flag"           = 0
           AND "perm_role_id" = #{permRoleId}
    </update>
</mapper>
