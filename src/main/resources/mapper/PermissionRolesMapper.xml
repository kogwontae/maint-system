<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="maint.mapper.PermissionRolesMapper">

    <select id="getPermissionRolesNameByPk" resultType="java.lang.String">
        SELECT "perm_role_name"
          FROM "permission_roles"
         WHERE "del_flag" = 0
           AND "perm_role_id" = #{values}
    </select>

    <select id="getPermissionRoles" resultType="PermissionRolesEntity">
        SELECT "perm_role_id"
             , "perm_role_name"
          FROM "permission_roles"
         WHERE "del_flag" = 0
      ORDER BY "perm_role_id"
    </select>

    <select id="countPermissionRoles" resultType="java.lang.Long">
        SELECT COUNT("perm_role_id")
          FROM "permission_roles"
         WHERE "del_flag" = 0
        <if test="permRoleName != null and permRoleName != ''">
           AND "perm_role_name" LIKE #{likeSearchPermRoleName}
        </if>
    </select>
    
    <select id="getPermissionRolesList" resultType="PermissionRolesEntity">
        SELECT "perm_role_id"
             , "perm_role_name"
        FROM "permission_roles"
        WHERE "del_flag"          = 0
        <if test="permRoleName != null and permRoleName != ''">
            AND "perm_role_name" LIKE #{likeSearchPermRoleName}
        </if>
        ORDER BY "perm_role_id"
        LIMIT #{displayNum}
       OFFSET #{startRowNum}
    </select>

    <select id="isDuplePermRoleName" resultType="boolean">
        SELECT EXISTS (SELECT 1
          FROM "permission_roles"
         WHERE "del_flag"            = 0
        <if test="permRoleId != null">
           AND "perm_role_id" != #{permRoleId}
        </if>
           AND "perm_role_name"      = #{permRoleName}
        )
    </select>

    <select id="countUsedPermissionRoles" resultType="java.lang.Integer">
        SELECT COUNT("perm_role_id")
          FROM "permission_roles"
         WHERE "del_flag" = 0
           AND "perm_role_id" IN (SELECT "perm_role_id" FROM "users"
         WHERE "del_flag"           = 0
           AND "perm_role_id" = #{permRoleId})
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="permRoleId">
        INSERT INTO "permission_roles" (
            "perm_role_name"
            <include refid="maint.mapper.CommonMapper.insertCommonItemColumns"/>
      ) VALUES (
            #{permRoleName}
            <include refid="maint.mapper.CommonMapper.insertCommonValues"/>
        )
    </insert>

    <update id="update">
        UPDATE "permission_roles"
           SET "perm_role_name" = #{permRoleName}
               <include refid="maint.mapper.CommonMapper.updateCommon"/>
         WHERE "perm_role_id" = #{permRoleId}
    </update>

    <update id="delete">
        UPDATE "permission_roles"
           SET "del_flag"     = #{permRoleId}
              <include refid="maint.mapper.CommonMapper.deleteCommon"/>
         WHERE "perm_role_id" = #{permRoleId}
    </update>

</mapper>
