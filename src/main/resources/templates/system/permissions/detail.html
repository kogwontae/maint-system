<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layout}" th:with="title='権限管理'">
<body>
	<!-- start: contents -->
	<div layout:fragment="main_contents" th:object="${displayForm}">
		<!-- PAGE CONTENT WRAPPER -->
		<div class="page-content-wrap">
			<div class="row">
				<div class="col-md-12">
					<form id="form" method="post" class="form-horizontal" th:action="@{/system/permissions/detail/confirm/}">
						<input type="hidden" th:field="*{permRoleId}"/>
						<input type="hidden" th:field="*{page}"/>
						<input type="hidden" th:field="*{dispMode}" />
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title">
									<strong th:text="権限__*{dispMode.text}__">権限登録</strong>
								</h3>
							</div>
							<!-- START メッセージ表示部 -->
							<div th:replace="~{common/message :: common_message_box('success',${successMessages})}"></div>
							<div th:replace="~{common/message :: common_message_box('danger',${errorMessages})}"></div>
							<div th:replace="~{common/message :: common_message_box('warning',${warningMessages})}"></div>
							<!-- END メッセージ表示部 -->
						<table class="table">
							<tr>
								<th style="width: 50px;"><span class="label-important">必須</span></th>
								<th style="width: 100px;">権限名</th>
								<td style="text-align: left;">
									<input type="text" style="width: 450px;" id="permName" maxlength="20" autocomplete="off" name="permRoleName" th:value="*{permRoleName}" th:classappend="${#fields.hasErrors('permRoleName')} ? 'error' : ''" />
									<p th:if="${#fields.hasErrors('permRoleName')}" th:errors="*{permRoleName}" style="color:red" ></p>
								</td>
							</tr>
							<tr class="top-permission" th:each="topMenu, tp : ${permissionsList}">
								<th style="width: 50px;"><span class="label-important">必須</span></th>
								<th style="width: 80px;">
									<span th:text="${topMenu.menuName}"><i class="fa fa-bars" aria-hidden="true"></i>TopName</span>
									<input type="hidden" th:name="topMenuList[__${tp.index}__].menuName" th:value="${topMenu.menuName}"/>
								</th>
								<td style="text-align: left;">
									<table class="search-results-tbl">
										<thead>
										<tr>
											<th style="width: 30%;">業務画面名</th>
											<th>権限</th>
										</tr>
										</thead>
										<tbody>
										<tr th:each="subMenu, sp : ${topMenu.subMenuList}">
											<td th:text="${subMenu.menuName}">管理メニュー</td>
											<td>
												<div class="detail-permission" style="display: flex; justify-content: flex-start; gap: 20px;" >
													<input type="hidden" class="menu-id" th:value="${subMenu.menuId}"/>
													<input type="hidden" class="menu-name" th:value="${subMenu.menuName}"/>
													<input type="hidden" class="menu-code" th:value="${subMenu.menuCode}"/>
													<label class="inner-title"><input type="checkbox" class="read-perm" th:checked="${subMenu.readPermFlg} neq null and ${subMenu.readPermFlg} eq 1"/>権限_参照</label>
													<label class="inner-title"><input type="checkbox" class="write-perm" th:checked="${subMenu.writePermFlg} neq null and ${subMenu.writePermFlg} eq 1"/>権限_書込み</label>
													<label class="inner-title"><input type="checkbox" class="download-perm" th:checked="${subMenu.downloadPermFlg} neq null and ${subMenu.downloadPermFlg} eq 1"/>権限_帳票DL</label>
												</div>
												<th:block th:if="*{topMenuList} neq null">
													<p th:if="*{#fields.hasErrors('topMenuList[__${tp.index}__].subMenuList[__${sp.index}__].invalidPerm')}" th:errors="*{topMenuList[__${tp.index}__].subMenuList[__${sp.index}__].invalidPerm}" style="color:red"></p>
												</th:block>
											</td>
										</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</table>
							<div class="panel-footer">
								<input type="hidden" name="originSessionKey" th:value="*{sessionKey}">
								<div class="pull-right">
									<a th:href="@{'/system/permissions/' + *{page} + '/'}" class="btn btn-default">戻る</a>
									<button class="btn btn-primary" onclick="makePermissionList();">確認</button>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- END PAGE CONTENT WRAPPER -->
		<th:block th:insert="~{common/script :: common_script}"></th:block>
		<script type="text/javascript" th:src="@{/js/system/permissions/detail.js}"></script>
		<style>
			table, th, td {
				border: 1px solid #ccc;
				border-collapse: collapse;
			}

			th, td {
				padding: 8px;
				vertical-align: top;
			}

			.search-results-tbl tbody tr:nth-child(even) {
				background-color: #f9f1e6;
			}

			.search-results-tbl thead {
				background-color: #f2f2f2;
			}

			.table > tbody > tr > th {
				background-color: #f5f5f5;
				text-align: center;
			}

			.search-results-tbl {
				width: 100%;
				table-layout: fixed;
			}

			.table {
				width: 70%;
				table-layout: fixed;
			}

			.label-important {
				background-color: #d9534f;
				color: white;
				padding: 4px 4px;
				display: inline-block;
				border-radius: 4px;
				font-size: 12px;
			}
		</style>
	</div>
	<!-- end: contents -->
</body>
</html>
